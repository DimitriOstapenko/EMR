<% provide(:title, @patient.full_name) %>

<h1><%= @patient.full_name %> -  Patient profile </h1>

	<h1>Cardswipe Demo</h1>
	<p>Plug in your card reader and scan a card. This page uses the built-in card data parsers, which recognize various formats.</p>

	<h2>Scan data:</h2>
	<div class="result">
		<ul id="properties">
		</ul>
		<p>Status: <span id="status"></span></p>
	</div>

	<p>Scanning a card will not interfere with form fields. Type a few characters into the field below and start a scan.</p>

	<%= form_with url: patients_path, method: 'get', local: true, remote: :false, skip_enforcing_utf8: :true, id:'form' do |f| %>
	<%= f.text_field :findstr, id: :hidden, :onChange => 'javascript: this.form.submit()' %>
	<%= f.submit :submit, id: 'submit' %>
	<% end %>

params:	<%= @params.inspect %>
<br>
cardstr:<%= @cardstr.inspect %>

<!--
<script type="text/javascript">

//  Called on a successful scan, where one of the parsers recognizes the card data.

	     var success = function (data) {
			$("#status").text("Success!");
			var id = "<%= @patient.id %>"
		        var line1 = data['line1'];
		        var cardnum = line1.substring(7, 17);
		        var names = line1.substring(18,44);
		        var arr = names.split('/');

//			alert("Success!");
//			alert( cardnum + " : " + arr[0] + ', ' + arr[1] );
			
//jQuery.ajaxSetup({async:false});
//		     $.post({ url : "/patients/" + id + "/card", type : "POST", data : { cardstr: data["line1"] }, dataType: "script", success:function(json) { alert("Success2") } });

//$("#hidden").val(cardnum);
//$("#form").submit();

$.ajax({url: "/patients/" + id + "/card", data: { cardstr: data["line1"]}, dataType: "script", type: "POST" });
alert ("back in card");

		}

		var error = function () {
			alert("Failed");
			$("#status").text("Failed!");
			$(".line").text("");
		}

		$.cardswipe({
			success: success, 
			firstLineOnly: true,
			parsers: [ "generic"  ],
			error: error,
			debug: true
		});

</script>

-->

<!--

var array = [1, 2, 3, 4, 5];

$.ajax({
        url : "/customurl",
        type : "post",
        data : { data_value: JSON.stringify(array) }
    });

-->






