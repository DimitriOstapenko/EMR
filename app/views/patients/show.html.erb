<% provide(:title, @patient.full_name) %>
<%= render "shared/modal" %>
<% remote = device_is_desktop? %>

<h1><%= @patient.full_name %> (<%= @patient.pat_type %>):  Patient Profile &nbsp; <%= link_to '<i class="glyphicon glyphicon-edit"></i>'.html_safe, edit_patient_path(@patient), remote: true, 'data-toggle': "modal", 'data-target': '#modal-window' %></h1>

<div class="row">
  <aside class="col-md-6">
    <section class="user_info">
<pre class="pre-scrollable">
<% if @patient.pat_type == CASH_PATIENT %>
<b>CASH PATIENT</b> <%= link_to '<i class="glyphicon glyphicon-credit-card"></i>'.html_safe, label_patient_path(@patient), remote: remote, 'data-toggle':  "modal", 'data-target': '#modal-window',  method: 'get' %>
<% else %>
<b>INSURED PATIENT</b> <%= link_to '<i class="glyphicon glyphicon-credit-card"></i>'.html_safe, label_patient_path(@patient), remote: remote, 'data-toggle':  "modal", 'data-target': '#modal-window',  method: 'get' %>
<% if @patient.ohip_num %>
Health Card: <%= @patient.ohip_num %> <%= @patient.ohip_ver %> (<%= @patient.hin_prov %>) Expires: <%= @patient.hin_expiry %>
<% end %>
<% if @patient.ifh_number %>
IFH #: <%= @patient.ifh_number %> 
<% end %>
<% end %>
<b><%= @patient.full_name %></b>:  <%= @patient.age_str %>  <%= @patient.full_sex %>; Born: <%= @patient.dob %><% if @patient.chart_file.present? %> <%= link_to '<i class="glyphicon glyphicon-copy"></i>'.html_safe, chart_patient_path(@patient) %> <% end %>
Phone: <%= num_to_phone(@patient.phone) %> Mobile: <%= num_to_phone(@patient.mobile) %> <% if @patient.email.present? %> Email: <%= mail_to @patient.email %> <% end %>
Address: <%= @patient.addr %>
	    <%= @patient.city %> <%= @patient.prov %> 
	    <%= @patient.postal %>
<% if @patient.allergies.present? %>
Allergies: <%= @patient.allergies %>
<% end %>
<!-- active meds for this pat -->
<% if @patient.med_list %>
Medications:
     <%= @patient.med_list.join("\n     ") %>
<% end %> </b>
<% if @patient.meds.present? %>
<font color='red'><i> Old Medications to be deleted after conversion: <%= @patient.meds %> </i></font>
<% end %>

</pre>
	 
 <% if @patient.notes.present? %> 
 <div class="panel panel-info">
   <div class="patient-notes-panel-body">
	   <% html_str = "<pre class='notes'> #{@patient.notes} </pre>" %>
	   <%= html_str.html_safe %>
   </div>
</div>
<% end %>

&nbsp; <%= render("medications", remote: remote) if @patient.medications.any? %>
&nbsp; <%= render("prescriptions", remote: remote) if @patient.prescriptions.any? %>
&nbsp; <%= render("invoices", remote: remote) if @patient.invoices.any? %>
&nbsp; <%= render("letters", remote: remote) if @patient.letters.any? %>
&nbsp; <%= render("referrals", remote: remote) if @patient.referrals.any? %>

  </section>
</aside>

  <div class="col-md-6">
    <h3>Visits: (<%= @patient.visits.count %>)</h3>
    <% if @patient.visits.any? %>
        <table class="tbl">
  	  <thead>
	  <tr>
	    <th>Date</th>
	    <th>Bil.Type</th>
	    <th class="tbl_md">Edit</th>
	    <th>Doctor</th>
	    <th class="tbl_md">Diag.</th>
	    <th>Services</th>
	    <th class="tbl_md">Status</th>
	  </tr>
	  <tbody>

        <%= render @visits, remote: device_is_desktop? %>

          </tbody>
	</table>
	<div class="spacer-10"></div>
	<div class="row">
	<div class="col-md-9"><%= will_paginate @visits, class: "btn" %></div>
	<div class="col-md-3"> <%= link_to "Print Visit History", visit_history_patient_path(@patient),  remote: remote, 'data-toggle':  "modal", 'data-target': '#modal-window', class: "btn btn-info", method: 'get' %> </div>
	</div>
    <% end %>
  </div>

<div class="col-sm-12 " style="position: relative; bottom: 20px; top: 5px;">
<div class="row">  
   <%= render "buttons", remote: remote %> 
</div>
</div>

</div>

