<% provide(:title, @patient.full_name) %>
<%= render "shared/modal", size:'lg' %>
<% remote = device_is_desktop? %>

<h1><%= @patient.full_name %> :  Patient Profile </h1>

<div class="row">
  <aside class="col-md-6">
    <section class="user_info">
<pre class="pre-scrollable">
<b>Name: <%= @patient.full_name %> <%= @patient.age_str %>  <%= @patient.full_sex %> <% if @patient.chart_file.present? %> <%= link_to '<i class="glyphicon glyphicon-copy"></i>'.html_safe, chart_patient_path(@patient) %> <% end %>
Born: <%= @patient.dob %>
<% if @patient.pat_type == IFH_PATIENT %>
IFH #: <%= @patient.ifh_number %> 
<% else %>
Health Card: <%= @patient.ohip_num %> <%= @patient.ohip_ver %> (<%= @patient.hin_prov %>) Expires: <%= @patient.hin_expiry %>
<% end %>
Phone: <%= num_to_phone(@patient.phone) %> Mobile: <%= num_to_phone(@patient.mobile) %> <% if @patient.email.present? %> Email: <%= mail_to @patient.email %> <% end %>
Address: <%= @patient.addr %>
	    <%= @patient.city %> <%= @patient.prov %> 
	    <%= @patient.postal %>
<% if @patient.allergies.present? %>
Allergies: <%= @patient.allergies %>
<% end %>
<!-- active meds for this pat -->
<% if @patient.med_list %>
Medications:
     <%= @patient.med_list.join("\n     ") %>
<% end %> </b>
<% if @patient.meds.present? %>
<font color='red'><i> Old Medications to be deleted after conversion: <%= @patient.meds %> </i></font>
<% end %>

</pre>
	 
 <% if @patient.notes.present? %> 
 <b>Notes</b>
 <div class="panel panel-info">
   <div class="patient-notes-panel-body">
	   <% html_str = "<pre class='notes'> #{@patient.notes} </pre>" %>
	   <%= html_str.html_safe %>
   </div>
</div>
<% end %>

&nbsp; <%= render("invoices", remote: remote) if @patient.invoices.any? %>
&nbsp; <%= render("letters", remote: remote) if @patient.letters.any? %>
&nbsp; <%= render("referrals", remote: remote) if @patient.referrals.any? %>
&nbsp; <%= render("medications", remote: remote) if @patient.medications.any? %>

  </section>

<div class="row">

<% unless @patient.pat_type == DECEASED_PATIENT %>
  <div id="new_visit" class="col-sm-2">
  <% if remote %>
     <%= button_to 'New Visit', new_patient_visit_path(@patient), remote: true, 'data-toggle':  "modal", 'data-target': '#modal-window',class:"btn btn-primary btn-lg", method: 'get'  %> </td>
  <% else %>
     <%= button_to 'New Visit', new_patient_visit_path(@patient), class:"btn btn-primary", method: 'get' %>
  <% end %>
  </div>
<% end %>

  <div id="edit_pat" class="col-sm-2">
    <%= button_to "Edit Patient", edit_patient_path(@patient), remote: remote, 'data-toggle': "modal", 'data-target': '#modal-window', class:"btn btn-danger btn-lg", method: 'get' %>
  </div>

  <div id="modLabel" class="col-sm-2">
  <%= button_to "Label", label_patient_path(@patient), remote: remote, 'data-toggle':  "modal", 'data-target': '#modal-window',  class:"btn btn-info btn-lg", method: 'get'  %>
  </div>
  
  <div id="invoice" class="col-sm-2">
    <%= button_to "Invoice", new_patient_invoice_path(@patient), class: "btn btn-warning btn-lg", method: 'get' %> 
  </div>
  
  <div id="letter" class="col-sm-2">
    <%= button_to "Letter", new_patient_letter_path(@patient), class: "btn btn-success btn-lg", method: 'get' %> 
  </div>
  
  <div id="referral" class="col-sm-2">
    <%= button_to "Referral", new_patient_referral_path(@patient), class: "btn btn-primary btn-lg active", method: 'get' %> 
  </div>

  <div id="medication" class="col-sm-2">
    <%= button_to "+Medication", new_patient_medication_path(@patient), class: "btn btn-info btn-lg active", method: 'get' %> 
  </div>
</div>
  </aside>

  <div class="col-md-6">
    <h3>Visits: (<%= @patient.visits.count %>)</h3>
    <% if @patient.visits.any? %>
        <table class="tbl">
  	  <thead>
	  <tr>
	    <th>Time Stamp</th>
	    <th class="tbl_md">Edit</th>
	    <th>Doctor</th>
	    <th class="tbl_md">Diag.</th>
	    <th>Services</th>
	    <th class="tbl_md">Status</th>
	  </tr>
	  <tbody>

        <%= render @visits, remote: device_is_desktop? %>

          </tbody>
	</table>
	<%= will_paginate @visits %> 
    <% end %>
  </div>
</div>


