<% pat = Patient.find(visit.patient_id) rescue nil %>
<% return unless pat.present? %>
<tr>
	<% if visit.date == @date %>
            <td><%= link_to visit.entry_ts.strftime("%H:%M"), patient_visit_path(pat,visit) %></td>
         <% else %>
            <td><%= link_to visit.entry_ts, patient_visit_path(pat,visit) %></td>
         <%end %>
	<td><%= visit.doctor.lname %></td>
	<td><%= link_to pat.full_name, pat %></td>
	<td><%= pat.pat_type %></td>
	<td>
	<% if pat.pat_type == IFH_PATIENT %>
		<b><%= pat.ifh_number %></b>
        <% else %>
	   <%= pat.ohip_num_full %>
        <% end %>
	</td>
	<td><%= visit.diag_scode %></td>
	<td><%= visit.proc_codes %></td>
	<td><%= visit.all_btypes_str.join',' %></td>
	<td>
	<% if visit.status == PAID && visit.claim_id.present? %>
	  <%= link_to visit.status_str, claim_path(visit.claim_id) %> 		
	<% else %>
	  <%= visit.status_str %>
	<% end %>
	</td>
	<% if visit.was_today? || current_user.admin? %>
	  <td> <%= link_to "Label", label_patient_path(pat), method: 'get', target: "Label" %> </td>
	  <td> <%= link_to "Form", visitform_patient_visit_path(pat,visit), method: 'get', target: "Form" %> </td>
	  <td> <%= link_to "Edit",  edit_patient_visit_path(pat,visit) %> </td>
          <td> <%= link_to "Delete", patient_visit_path(pat,visit), method: :delete, data: { confirm: "Are you sure you want to delete visit #{visit.id} for patient #{pat.lname}?" } %> </td>
        <% else %>	
	  <td> <%= link_to "Label", label_patient_path(pat), method: 'get', target: "Label" %> </td>
	<% end %>
</tr>
