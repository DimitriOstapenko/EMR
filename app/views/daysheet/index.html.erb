<% date = params[:date].to_date rescue Date.today %>
<% provide(:title, "Day Sheet for " + date.to_s  ) %>
<% provide(:button_text, 'Save changes') %>

<% if current_doctor && date == Date.today%>
      <div class="navbar-text"><small>Doctor in: Dr. <b><%= current_doctor.lname rescue '' %></b>  Est. Wait: <b><%= current_wait_time %></b> min.</small></div>
<% end %>

<table class="tbl table-hover" >
  <thead>
      <tr>
	  <% if date  %>
	    <th class="tbl_lsm"><%= sortable 'entry_ts', :Time %></th>
	  <% else %>
	    <th class="tbl_md"><%= sortable 'entry_ts', :Date %></th>
	  <%end %>

	  <th class="tbl_md">
	  <% if @docs.size > 1 %>
          <span class="dropdown" >
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><font color="white"> Doctor <b class="caret"></b></font> </a>
            <ul class="dropdown-menu">
              <li><%= link_to "All", params.permit(:date).merge(date: params[:date]) %></li>
              <% @docs.each do | doc | %>
		<li><%= link_to doc.lname, params.permit(:doc_id,:date).merge(doc_id: doc.id, date: params[:date]) %> </li>
              <% end %>
            </ul>
          </span>
	  <% else %>
		Doctor  
	  <% end %>	
          </th>

          <th class="tbl_lmd">Patient</th>
          <th class="tbl_lsm">Health #</th>
          <th class="tbl_sm">Ver.</th>
          <th class="tbl_lsm">Diagnosis</th>
          <th class="tbl_xmd">Procedures</th>
          <th class="tbl_sm">Bil.Type</th>
          <th class="tbl_lsm">Status</th>
	  <% if date == Date.today || current_user.admin? %>
	    <th class="tbl_sm"></th>
            <th class="tbl_sm"></th>
            <th class="tbl_sm"></th>
          <% end %>
          <th class="tbl_sm"></th>
      </tr>
  </thead>
  <tbody>

  <% @daysheet.each do |v| %>
     <%= render 'visit', visit: v %>
  <% end %>

  </tbody>
</table>

<div class="bottom_buttons ">
<%= will_paginate @daysheet, class: "btn" %> 
</div>

