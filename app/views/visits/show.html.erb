<%   
  @patient = Patient.find(@visit.patient_id) 
  @doctor = Doctor.find(@visit.doc_id)
  provide(:title, "#{@patient.full_name} : #{@visit.entry_ts}") 
%>

<h1> <%= @patient.full_name %> : Visit of <%= time_tag(@visit.entry_ts) %>  </h1>

<% diag = Diagnosis.find_by(code: @visit.diag_code) %>
<% codes = [@visit.proc_code, @visit.proc_code2, @visit.proc_code3, @visit.proc_code4] %>

<div class="form-group col-sm-10 col-md-10 col-sm-offset-1 col-md-offset-1">
<div class="row">
	
<section>
<pre class="pre-scrollable">
<b>Doctor</b> :    <%= @visit.doctor.lname %>
<b>Reason for Visit </b>: <%= @visit.reason %>
<b>Diagnosis</b> : <%= @visit.diag_code %> : <%= diag.descr rescue '' %>
<b>Procedure(s)</b> : <%=  @visit.proc_codes %>
<b>Billing Type(s) </b>: <%= @visit.bil_type_str %>, <%= @visit.bil_type2_str %>, <%= @visit.bil_type3_str %>, <%= @visit.bil_type4_str %>
<b>Units </b>: <%= @visit.services.collect{|s| s[:units]}.join',' %>0
<b>Billed amount: <%= sprintf '$%.2f',@visit.total_fee %> Insured services: </b><%= sprintf '$%.2f',@visit.total_insured_fees %> <b>Other services:</b> <%= sprintf '$%.2f',@visit.total_non_insured_fees %>
<b>Vital signs</b>: T: <%= @visit.temp %> P: <%= @visit.pulse %> BP: <%= @visit.bp %>
<b>Duration </b>: <%= @visit.duration %> minutes
<b>Status </b>: <%= @visit.status_str %> 
<b>Entry by </b>: <%= @visit.entry_by %>
<b>Entered at </b>: <%= @visit.entry_ts %>
<b>Billing Ref# </b>: <%= @visit.export_file %>
<% if @visit.amount.present? %>
<b>Amount Paid </b>: <%= sprintf '$%.2f', @visit.amount %>
<% end %>
</pre>

<% if @visit.notes.present? %>
<div class="panel panel-info">
   <div class="visit-notes-panel-body">
<b>Notes </b>: <%= @visit.notes %>	     
   </div>
</div>
<% end %>

</section>
</div>

<p>
<div class="row">
 <div class="col-sm-3 col-md-2">
  <%= button_to "Edit Visit", edit_patient_visit_path(@patient), class: "btn btn-primary", :method => "get" %>
 </div>
 <div class="col-sm-3 col-md-2">
 <%= button_to "Print Visit Form", visitform_patient_visit_path(@patient), class: "btn btn-primary", method: 'get', formtarget: "Form"  %>
 </div>
 <div class="col-sm-3 col-md-2">
 <%= button_to "Print Referral Form", referralform_patient_visit_path(@patient), class: "btn btn-primary", method: 'get', formtarget: "Form"  %>
 </div>

 <% if @visit.cash? %> 
 <div class="col-sm-3 col-md-2">
 <%= button_to "Print Receipt", receipt_patient_visit_path(@patient), class: "btn btn-primary", method: 'get', formtarget: "Receipt"  %>
 </div>
 <% end %>
 
 <% if @visit.ready_to_bill? %>
 <div class="col-sm-3 col-md-2">
 <%= button_to "Send to Cab.md", sendclaim_patient_visit_path(@patient), class: "btn btn-primary", method: 'get'  %>
 </div>
 <% end %>

</div>
</div>


